<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Module exprecs</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module exprecs</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>Parse transform for generating record access functions.

<p><b>Authors:</b> : Ulf Wiger (<a href="mailto:ulf.wiger@ericsson.com"><tt>ulf.wiger@ericsson.com</tt></a>).</p>

<h2><a name="description">Description</a></h2>Parse transform for generating record access functions.
  <p>This parse transform can be used to reduce compile-time
  dependencies in large systems.</p>
  <p>In the old days, before records, Erlang programmers often wrote
  access functions for tuple data. This was tedious and error-prone.
  The record syntax made this easier, but since records were implemented
  fully in the pre-processor, a nasty compile-time dependency was
  introduced.</p>
  <p>This module automates the generation of access functions for
  records. While this method cannot fully replace the utility of
  pattern matching, it does allow a fair bit of functionality on
  records without the need for compile-time dependencies.</p>
  <p>Whenever record definitions need to be exported from a module,
  inserting a compiler attribute,
  <code>export_records([RecName|...])</code> causes this transform
  to lay out access functions for the exported records:</p>
 
  <pre>
  -module(test_exprecs).
 
  -record(r, {a, b, c}).
  -export_records([r]).
 
  -export(['#new-'/1, '#info-'/1, '#info-'/2, '#pos-'/2,
           '#is_record-'/2, '#get-'/2, '#set-'/2, '#fromlist-'/2,
           '#new-r'/0, '#new-r'/1, '#get-r'/2, '#set-r'/2,
           '#pos-r'/1, '#fromlist-r'/2, '#info-r'/1]).
 
  '#new-'(r) -&gt; '#new-r'().
 
  '#info-'(RecName) -&gt; '#info-'(RecName, fields).
 
  '#info-'(r, Info) -&gt; '#info-r'(Info).
 
  '#pos-'(r, Attr) -&gt; '#pos-r'(Attr).
 
  '#is_record-'(r, Rec)
      when tuple_size(Rec) == 3, element(1, Rec) == r -&gt;
      true;
  '#is_record-'(_, _) -&gt; false.
 
  '#get-'(Attrs, Rec) when is_record(Rec, r) -&gt;
      '#get-r'(Attrs, Rec).
 
  '#set-'(Vals, Rec) when is_record(Rec, r) -&gt;
      '#set-r'(Vals, Rec).
 
  '#fromlist-'(Vals, Rec) when is_record(Rec, r) -&gt;
      '#fromlist-r'(Vals, Rec).
 
  '#new-r'() -&gt; #r{}.
 
  '#new-r'(Vals) -&gt; '#set-r'(Vals, #r{}).
 
  '#get-r'(Attrs, R) when is_list(Attrs) -&gt;
      ['#get-r'(A, R) || A &lt;- Attrs];
  '#get-r'(a, R) -&gt; R#r.a;
  '#get-r'(b, R) -&gt; R#r.b;
  '#get-r'(c, R) -&gt; R#r.c;
  '#get-r'(Attr, R) -&gt;
      erlang:error(bad_record_op, ['#get-r', Attr, R]).
 
  '#set-r'(Vals, Rec) -&gt;
      F = fun ([], R, _F1) -&gt; R;
              ([{a, V} | T], R, F1) -&gt; F1(T, R#r{a = V}, F1);
              ([{b, V} | T], R, F1) -&gt; F1(T, R#r{b = V}, F1);
              ([{c, V} | T], R, F1) -&gt; F1(T, R#r{c = V}, F1);
              (Vs, R, _) -&gt;
                  erlang:error(bad_record_op, ['#set-r', Vs, R])
          end,
      F(Vals, Rec, F).
 
  '#fromlist-r'(Vals, Rec) -&gt;
      AttrNames = [{a, 2}, {b, 3}, {c, 4}],
      F = fun ([], R, _F1) -&gt; R;
              ([{H, Pos} | T], R, F1) -&gt;
                  case lists:keyfind(H, 1, Vals) of
                    false -&gt; F1(T, R, F1);
                    {_, Val} -&gt; F1(T, setelement(Pos, R, Val), F1)
                  end
          end,
      F(AttrNames, Rec, F).
 
  '#pos-r'(a) -&gt; 2;
  '#pos-r'(b) -&gt; 3;
  '#pos-r'(c) -&gt; 4;
  '#pos-r'(_) -&gt; 0.
 
  '#info-r'(fields) -&gt; record_info(fields, r);
  '#info-r'(size) -&gt; record_info(size, r).
  </pre>
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#parse_transform-2">parse_transform/2</a></td><td></td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="parse_transform-2">parse_transform/2</a></h3>
<div class="spec">
<p><tt>parse_transform(Forms, Options) -&gt; any()</tt></p>
</div>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Feb 25 2010, 07:32:25.</i></p>
</body>
</html>
